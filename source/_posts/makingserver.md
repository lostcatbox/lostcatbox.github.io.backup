---
title: 개인서버 만들기
date: 2020-05-26 22:38:27
categories: [Server]
tags: [Network, Server, Tip, Basic]
---

# 왜?

개인서버로 내가 원하는 프로젝트를 운영할 수 있다면 얼마나 좋을까? 

전기값만 들고 , 개발서버와 실서비스 서버를 분리하여 내 마음대로 설계, 구축이 가능해진다.

그래서 현재 개인서버를 구축하는 중이다

단기목표는 서버>hypervisor>우분투,window server를 설치 후 우분투 내부에 도커를 설치하여(2020.05.27 구현성공)

지금까지 만든 프로젝트의 api를 aws서버에서 내 개인서버로 운영하는 것이 목적이다.

하지만 목표를 달성하려면 ip, dns, 이런 개념도 알아야됨은 물론이고 보안 이슈도 해결을 해야하므로 상당한 공부가 필요해졌다.

\+ 중장기 목표는 서버에 대해서 누구에게 기본적인 원리는 부담없이 설명해주고싶었다.

전부 혼자하신분.. [자세히]([https://www.popit.kr/%EC%8A%A4%ED%83%80%ED%8A%B8%EC%97%85-%EA%B0%9C%EB%B0%9C%EC%9E%90-%ED%98%BC%EC%9E%90-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%8B%B8%EA%B2%8C-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0-1%ED%8E%B8/](https://www.popit.kr/스타트업-개발자-혼자-빠르게-싸게-서버-구축하기-1편/))



# 서버

## 기본 구조

[자세히](https://www.2cpu.co.kr/lec/2350?&sfl=wr_subject&stx=Esxi&sop=and)

![스크린샷 2020-05-26 오후 9.43.49](https://tva1.sinaimg.cn/large/007S8ZIlgy1gf65023px0j30u20u0jwy.jpg)

### Client

최초의 클라이언트로부터 요청 발생> 네이트워크 장비로 수신

### Modem

가장 먼저 네트워크 패킷(요청할주소, 내용이 적혀있는 택배와 유사)을 받는 것이다.

통신사로부터 가장 먼저 연결되는 장비

### 공유기(Cable/DSL Router)

두번째로 네트워크 패킷을 전달 받는 것은 공유기로 보통 iptime, 미크로틱 같은 것

패킷은 공유기에 등록된 Port Forwarding 또는 DMZ 같은 Role에 의해 지정된 단말기에 전달된다.

> 클라이언트(외부)>모뎀>공유기로 요청전달됨(응답은 반대겠지...)

## 서버

위의 과정을 통해 페킷이 서버에 전달된다.

### ESXI 

서버 가상화 아키텍처인 <ESXi>는 물리적인 서버에 OS처럼 직접 설치하여, 여러 가상머신(Virtual Machine)으로 파티셔닝할 수 있는 <베어메탈> 하이퍼바이저 입니다.

즉, ESXI위에 올리면 윈도우, 우분투가 각각 가상머신으로 가상화 서버가 됨.

맨위의 그림에서 Virtualazation Server이하는 모두 논리적인 구성이므로, 이 위에다가 바로 linux 서버, window서버를 설치하면, 그림에서 Control, Firewall, Proxy, 가상 NAT같은 구성은 사라짐(매우위험함)

즉, 하나가 뚤리면 내부 서버나 단말기들도 공격당할 가능성이 매우 높아지는 구성임

### NAT, Proxy, etc... + Server

즉, 가상화 서버 구축후 내부적으로도 Router, 방화벽 등을 구축할 수 있고 구축된 가상화 서버로부터 전달 받은 네트워크 패킷을 Router, Firewall을 거쳐 내부의 네트워크 망으로 전달하게 된다.

따라서 pfSense라는 방화벽이자, 가상의 라우팅 서버를 구성하여 논리적 망분리를 구성할 것이다.

이렇게 되면 "외부>모뎀>공유기>가상화서버>pfSense"순으로 요청 페킷이 통과하게되겠지.

#### NAT(Network Address Translation)

NAT구성 = 내부 네트워크, 사설망임

위의 그림에서는 개발 NAT, 실서비스 NAT으로 나눠놓음

논리적 망분리가 이뤄지지 않은 네트워크면, 하나 서버가 해킹당하면 다른곳도 접근가능해서 위험.(논리적 망분리를 하고 있는 상위개체가 해킹당하지 않는 이상..)

가상화 서버를 통해 구성된 NAT은 구성하기에 따라 논리적인 망분리를 구축하는 것도 가능한데 가상화 서버 또는 가상화 서버 내 Router또는 Firewall로 부터 전달받은 패킷을 목적지 네트워크가 수신하게 된다.

#### Proxy(프록시)

내부적인 망분리를 구축한 경우 내/외부의 통신을 위해 프록시 서버를 구축할 수 있다. 

보통 웹 서비스를 제공하는 경우 리버스 프록시(Reverse Proxy)환경을 구축하기도한다

> 포워드 프록시는 요청자들이 요청할때 프록시 서버에서 모아서 해당하는 사이트 접근
>
> 리버스 프록시는 요청들이 직접 서버에 들어오는 것이아니라 리버스 프록시 서버가 먼저 요청을 받고 해당하는 내부 서버에 다시 요청.(보안!!)(외부에서 직접 해당서버 접속 불가)

 모든 망을 경유하는 하나의 서버를 만들어 볼 예정입니다. 바로 Reverse Proxy 서버를 구축해 볼 예정, 

이 Reverse Proxy 는 논리적 망분리가 이루어진 모든 NAT에 다리를 거치고 있어 외부에서 요청된 Domain 등에 따라 접근처리를 해 줄 것이고, 웹 서버가 받는 요청 부하를 줄여줄 수 있도록 고려할 것입니다.

#### Server

모든 네트워크구간을 정상적으로 통과한 요청은 목적지에 도달해 처리가 되고, 발생된 응답 결과는 역순으로> 클라이언트까지 응답반환

> 나머지는 NAT수를 늘리고
>
> pfSense의 Role 정의는 필요에 따라 커스터마이징 하셔서 자신이 원하는 환경을 구축하시면 되겠습니다.



# 라우터

[자세히](https://studyforus.tistory.com/27)

외부에서 접속할 수 있는 방법은 3가지

- 포트포워드
- DMZ
- Twin IP



# IP주소는 한개일때 서버 여러대

[자세히](http://www.2cpu.co.kr/bbs/board.php?bo_table=QnA&wr_id=559051)

위의구성 참고하기