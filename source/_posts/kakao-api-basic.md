---
title: 카카오채널 구현해보기
date: 2020-01-22 19:04:47
categories: Kakao
tags: [Kakao, basic]
---

# Kakao api 시작하기 전에

이 내용은 모두 [KakaoDevelopers 개발가이드]([https://developers.kakao.com/docs/ios/kakao-talk-channel#%EC%B9%B4%EC%B9%B4%EC%98%A4%ED%86%A1-%EC%B1%84%EB%84%90-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0](https://developers.kakao.com/docs/ios/kakao-talk-channel#카카오톡-채널-추가하기))에 있는 내용임을 알립니다!

[개발자로 회원가입](https://developers.kakao.com/)

# 시작하기

## 카카오 채널관리자 만들기

카카오톡채널 관리자센터 [여기](https://accounts.kakao.com/login/kakaoforbusiness?continue=https://center-pf.kakao.com/)

카카오 developer관련 질문 [여기](https://i.kakao.com/forum/)

카카오 api 소개 및 다루는 법 소개 [여기](https://developers.kakao.com/features/kakao#%EC%B9%B4%EC%B9%B4%EC%98%A4%ED%86%A1-%EC%B1%84%EB%84%90-API](https://developers.kakao.com/features/kakao#카카오톡-채널-API))

위 사이트안에서 카카오채널에 관한 소개 [여기]([https://developers.kakao.com/features/kakao#%EC%B9%B4%EC%B9%B4%EC%98%A4%ED%86%A1-%EC%B1%84%EB%84%90-API](https://developers.kakao.com/features/kakao#카카오톡-채널-API))

카카오채널에서 플러스 친구과 연결된 다양한 오픈 빌더 플랫폼 [여기](https://i.kakao.com/login)

[나중에 삭제 예정된 참고자료](https://github.com/Beomi/where-is-my-customs)

## OBT신청하기 [여기](https://i.kakao.com/login)

__주의사항__

챗봇의 사용목적을 정확히 서술하지 않고 챗봇 OBT를 신청할 경우 잘못하면 6일이라는 시간을 날릴 수도 있으니 신청할때 아래 중요시 생각되는 것들과  예시를 통해 꼼꼼히 작성하길 바란다

~~(나도그냥했다가바로짤림)~~

```
“챗봇의 사용 목적이 불분명하여 OBT 승인 신청이 반려되었습니다.
카카오 i 디벨로퍼스 OBT 참여를 희망하시는 경우, 플러스친구 홈과 신청사유에 챗봇의 성격을 뚜렷하게 명시해주시길 바랍니다.
예시로 주변 맛집을 찾아주는 ‘맛집봇’, 특정 인물의 Q&A를 알려주는 ‘인물봇’ 등 챗봇의 사용 목적이 드러나면 좋습니다.
플러스친구 이름, 프로필 이미지, 카테고리 등 플러스친구 정보를 정확히 입력 후, 공개로 설정된 플러스친구 계정 URL을 정확하게 입력하여 다시 신청해주시기 바랍니다.
OBT에 신청해주셔서 감사합니다.”
```

## 주요개념

### 엔티티

- **엔티티(Entity)**란 봇이 이해할 수 있는 용어를 체계적으로 정리한 데이터 사전입니다. 엔티티가 정의되어 있다면, 봇은 __사용자 발화로부터 사용자의 의도에 맞는 동작 수행을 위한 주요 데이터를 추출할 수 있게 됩니다.__
- 엔티티명>대표엔트리(1,2,3,)>동의어(A,B,C...)로 구성되어있다.
- 엔티티는 __나의엔티티__(내가직접입력) , __시스템엔티티__(카카오측에서 만들어놓음)(날짜, 시간, 숫자 등등)로 구별된다.
- 엔티티가 있다면 사용자가 비슷한 말을 발화한 것에서 원하는 값을 객체로 가져올수있다.

### 시나리오



- **시나리오(Scenario)** 는 봇 안에서 사용자가 경험할 수 있는 서비스 단위입니다.

  예를 들어 금융과 관련된 서비스를 제공하는 봇이 있다고 가정하면 이 봇이 제공할 수 있는 서비스 단위, 즉 시나리오는 ‘예금’, ‘적금’, ‘대출’, ‘연금’, ‘방카슈랑스’ 등이 될 수 있습니다.

-  사용자의 의도(Intent)를 응대하는 가장 작은 단위를 블록(Block)이라고 하는데, 하나의 시나리오는 다양한 블록들이 모여서 이루어지게됩니다. 즉, 봇 작업자는 이러한 시나리오 단위로 다수의 블록들을 원하는 서비스 별로 그룹핑하여 체계적으로 관리할 수 있습니다.

#### 시나리오 종류

- 기본 시나리오

  기본 시나리오는 모든 봇에 장착되어있으며 웰컴 블록(봇이 사용자 처음 만날때), 폴백 블록(봇이 사용자의 발화 의도를 이해하지 못할떄 내뱉는 메세지 정의), 탈출 블록(봇의 되묻기 상황등에서 사용자가 대화를 초기화or탈출하고 싶을 때 쓰는 사용자 명령어를 정의함) 존재

- 커스텀 시나리오

  커스텀 시나리오는 봇 작업자가 서비스 단위 등으로 구분하며 지속 생성할 수 있습니다.

#### 시나리오 설정

- 모든 시나리오에 공통적으로 적용할수 있는 '속성'을 정의 할수있다.

- 두가지

  > ### 되묻기 질문
  >
  > 대표적으로 봇 작업자가, 봇이 사용자로부터 특정 정보 (= ’파라미터값’ 이라고 합니다. [**파라미터 설정**](https://i.kakao.com/docs/key-concepts-parameters#봇빌더에-들어가는-파라미터-값) 참조)를 획득까지 물어보는 질문을 ‘되묻기 질문’이라고 하며, 이를 본 설정 메뉴안에서 직접 정의할 수 있습니다.
  >
  > - 최대 횟수(8회까지) 및 초과시 안내 메시지
  > - 되묻기 대기 시간 (10분/20분/30분/60분/120분) & 초과시 안내 메시지

  > ### 봇 제네릭(Generic) 메뉴
  >
  > 봇 제네릭 메뉴는 카카오톡 챗봇 안에서 하단에 슬라이드 메뉴 형태로 존재하는 사용자 인터페이스를 의미합니다.
  >
  > 챗봇 사용자가 아래에서 위로 해당 공간을 쓸어올려 언제나 중요 필수 메뉴를 쉽게 접근할수 있도록 하는 메뉴입니다. 봇 작업자는 본 공통 설정안에서 제네릭 메뉴에 사용여부를 스위치 On/Off 형태로 간편하게 셋팅할 수 있습니다.
  >
  > - 카카오 i 오픈빌더의 봇 제네릭 메뉴는 개발 채널을 연결해야 볼 수 있습니다.
  > - 봇 제네릭 메뉴에서 '상담원으로 전환하기' 버튼을 최상단 또는 최하단으로 이동할 수 있습니다.
  > - 개발 채널에 상담톡을 연결하여 봇 제네릭 메뉴를 테스트하실 경우 **상담톡 api를 제공하는 딜러사에 비과금 개발 채널 생성을 요청**하셔야합니다. (임의로 채널 생성 후 테스트 시 상담톡 사용료가 과금될 수 있습니다)

Tip: **nformation.** **제네릭 메뉴에서 ‘상담원으로 전환하기’ 설정하기**

’상담원으로 전환하기’기능을 사용하기 위해서는 아래 조건을 충족해야 합니다.

1. 운영 채널과 개발 채널을 모두 연결해야 합니다.
2. 운영 채널과 개발 채널에의 1:1 채팅 설정이 모두 ON이 되어 있어야 합니다.
   해당 설정은 카카오톡 채널 관리자 센터에서 진행할 수 있습니다. [카카오톡 채널 관리자 센터가기](https://center-pf.kakao.com/)



해당 봇을 배포하시면 카카오 i 오픈빌더에 연결한 운영 채널에도 동일한 봇 제네릭 메뉴 설정이 적용됩니다. (단, 운영 채널에도 상담원 전환 설정이 되어있어야 합니다)



상세한 설정 방법은 [**튜토리얼 > 시나리오와 블록 만들기**](https://i.kakao.com/docs/tutorial-chatbot-key-features#시나리오와-블록-만들기)를 참조하시길 바랍니다.'



### 블록 (매우 중요개념)

- **블록(Block)** 이란 사용자 의도의 기본 단위로, `인텐트(Intent)`라고도 불립니다. 1개의 블록은 1개의 의도를 표현하며, 사용자 발화가 봇으로 유입되면, 블록안에 사전에 등록된 발화내용을 기반으로 사용자 의도가 파악되어 1개 블록이 최종 추출됩니다.

  __이때 블록안에는 사용자 예상 발화, 그리고 봇이 수행할 액션과 응답할 내용이 설계됩니다.__(중요)

  예를 들면, 주로 ‘날씨 알려주기, 메시지 보내기, 지역 검색하기’ 와 같이 봇의 수행 미션(Task) 단위로 블록이 설계됩니다.

![block-overview](https://i.kakao.com/docs/assets/key-concepts/block-overview.png)



- ### 주요 기능 구성

  - 사용자 발화 패턴
  - 파라미터
  - 봇 응답 형식
  - 스킬
  - 컨텍스트

#### 블록의 종류

기본 블록은 봇이 구동할 때 필요한 최소한의 이벤트를 정의한 블록입니다. 봇 생성시 자동으로 생성되고 삭제가 불가능하며, 시나리오 메뉴에 있는 ‘시나리오 설정’ 에서 수정이 가능합니다.

- 웰컴 블록 (처음 사용시)
- 폴백 블록 (사용자의 발화 의도가 어떠한 블록과도 매칭안될때 응답설정하는블록)
- 탈출 블록(봇의 되묻기상황에서 대화 초기화, 탈출시 사용)

## 스킬

- **스킬**은 블록의 출력과 하는 일이 비슷합니다. 사용자에게 정보를 출력하는 것도, 특정 블록에 종속된다는 성질도 비슷합니다. 스킬도 해당 블록의 발화에 반응하여 응답을 돌려주게 됩니다. 즉 __‘블록에 종속되어 사용자에게 응답을 돌려주는 기능’__ (블록이 데이터 보내주면 실행됨)

- 블록의 출력만으로 한계가 있는 예시들>>>이때 스킬을 쓰면 쉽게 문제해결

  - 사용자가 어떤 야구팀을 좋아하는지 기록하고 이에 맞게 대답해야 한다면? 
  - 실시간으로 날씨를 알려줘야 한다면? 
  - 오늘 새로 입고된 상품을 보여줘야 한다면?




### 스킬의 역할

#### 출력

- 스킬은 출력으로 사용이 가능합니다. 발화에 따라서 출력의 큰 틀이 바뀌거나 많은 요소들이 바뀌는 상황이라면 일일이 데이터로 바꾸는 것보다 통째로 응답을 만들어서 주는 것이 낫습니다.
- 스킬은 출력으로 사용이 가능합니다. 발화에 따라서 출력의 큰 틀이 바뀌거나 많은 요소들이 바뀌는 상황이라면 일일이 데이터로 바꾸는 것보다 통째로 응답을 만들어서 주는 것이 낫습니다.
- 예시)
  - 주문을 받는 봇이 있습니다. 주문 봇은 사용자의 주문 내역을 저장하고, 주문 끝이라는 발화가 들어오기 전까지 계속하여 주문을 진행합니다. (카트식 주문이라고 합니다.) 이 상황에서 주문 봇은 사용자가 주문하는 메뉴에 따라서 메뉴를 추천하거나, 사용자가 기입한 기록을 토대로 알레르기와 같은 경고를 중간에 추가할 수 있습니다.

#### 데이터

- 스킬은 데이터로 사용이 가능합니다. 출력의 큰 틀이 바뀌지 않고 구체적인 몇 가지 요소만 바뀌면 된다는 상황이라면, 굳이 모든 응답을 스킬을 통해서 만들 필요가 없습니다.

- 예시)

  - 시간으로 환율을 보여주는 봇이라면 그 봇의 출력은 아래와 같을 것입니다.

    (**Example.** “hh시 mm분, 현재 환율은 xxx원입니다.”)

    출력에서 필요로 하는 데이터는 ‘시간’, ‘분’, 그리고 ‘환율 수치’입니다. 그렇다면, 모든 내용을 스킬로 만들 필요 없이 데이터에 해당하는 값만 스킬 서버에서 반환하고, 이를 블록의 출력에서 이용하는 방식을 사용하면 됩니다.

### 스킬 한 눈에 보기

- 스킬 응답을 처리하는 스킬 서버를 생성합니다.

- 오픈빌더에서 스킬을 생성하여 생성한 스킬 서버의 *엔드포인트를 등록합니다

  tip: **엔드포인트란?**
  스킬 서버의 엔드포인트는 요청을 전송할 수 있는 창구를 의미합니다. 예를 들면, 스킬 서버의 주소를 i.kakao.com 이라 가정합니다. 그리고 ‘i.kakao.com/**a**‘, ‘i.kakao.com/**b**‘ 이렇게 두 개의 url에 요청을 전달하면 그 응답을 반환하도록 만들었습니다. 이 경우, ‘i.kakao.com/a’와 ‘i.kakao.com/b’는 각각 스킬 서버의 엔드포인트가 됩니다.

- 위에서 만든 스킬과 블록을 연결합니다

- 스킬과 연결한 블록이 활성화되면(ex. 사용자가 블록에 등록된 발화로 봇에게 말을 건 경우), 봇 시스템은 스킬에 등록된 엔드포인트로 요청을 전송합니다.

- 스킬 서버에서 응답을 만들어 반환하면, 봇 시스템은 이를 토대로 사용자에게 전달할 출력 모습을 만들고 카카오톡에 그립니다. [**스킬 개발 가이드 > 응답타입별 JSON포맷**](https://i.kakao.com/docs/skill-response-format)

## 발화 패턴

- 오픈빌더로 챗봇을 만들 때, 챗봇이 사용자 발화를 인식할 수 있도록 만드는 원리의 핵심은 **패턴(Pattern)** 입니다. 발화 패턴을 만드는 기본 과정은 다음과 같습니다.(즉, 봇이 사용자들이 '이렇게 말할 것이다' 예상되는 발화문 등록)
- 챗봇이 사용자 의도를 이해하기 위해, 추출된 엔티티 정보는 가장 중요한 열쇠입니다. 

## 파라미터 설정

- **파라미터(Parameter)** 는 봇이 사용자의 의도를 정확히 이해하기 위해 필요로 하는 데이터를 일컫습니다. 봇과의 대화는 파라미터 데이터를 채우는 작업이다. 따라서 필요한 데이터가 없으면 봇이 되묻기를 한다. >>>스킬에 데이터(파라미터)가 보내지면 들어온 데이터에 맞는 다양한 결과값을 보내줍니다(우리서버에 ???)

- 한 블록내에서 파라미터 명은 유일

- 스킬을 제작하는 작업자는 필요한 파라미터 등에 대한 내용을 정의하게 됩니다.

  예시) ‘지역별 날씨를 알려주는 스킬’을 제작했다면, 지역명을 스킬로 보내게 되고 실제 날씨정보를 출력해서 보내주게됩니다. 여기에서 스킬로 보내지는 지역 정보를 ‘파라미터 데이터’로 볼 수 있습니다.

### 파라미터 구성 요소

#### 파라미터 명

- 파라미터를 구분하는 이름입니다

#### 엔티티

- 발화에 매핑된 에티티를 파라미터에 연결하는 역할을 합니다. 발화 입력시 유효한 엔티티가 있는 경우에는 추천 되고, 선택하여 태깅이 가능합니다.

#### 값

- ‘동작’영역에서 ‘값’은 ‘엔티티’를 통해서 채우거나 이전 또는 현재의 정보에 접근해서 값을 채울 수 있습니다. 이외에도 고정된 값을 지정해서 채울 수 있습니다. 값을 사용하기 위한 표현법은 다양합니다. 아래의 사용방법을 확인해 주세요.
  - 엔티티 값
    - ‘$’로 시작하는 이름으로 구성된 값
    - 주로, 파라미터 이름과 동일하게 사용
    - ex) $paramName1, $paramName2, …
  - 특정 값
    - 값 위치에 ‘#’으로 시작하는 이름으로 구성된 값
    - ‘current’를 사용해서 접근할 수 있는 값은 현재 대화의 발화 내용
    - ‘request payload’의 특정 path 값
    - ex) #[current|contextName].[path].[to]
  - 고정된 값
    - ‘$’ 이나 ‘#’ 으로 시작하지 않는 값
    - 값 자체가 실제 파라미터의 값으로 사용
  - 기본값
    - 필수 파라미터로 지정되지 않고 __사용자의 발화나 이전 또는 현재의 특정 값을 참조__하거나, 고정된 값이 설정되어 있지 않을 경우에 ‘기본 값’으로 채택해 사용되는 기본적인 값입니다.

#### 파라미터 검증 API

- __‘검증/변환’ 등의 작업을 스킬로 요청을 보내기 이전에__ 수행할 때 사용되는 항목입니다. __작업이 이루어질 때, 파라미터에 채워진 값이 ‘HTTP’요청의 ‘payload’로 사용되어 집니다.__

- 응답의 ‘검증/변환’의 결과 값이 스킬의 요청에 활용되며, API를 검증하기 위해서는 호출할 API url과 검증 실패시 에러메시지를 등록해야 합니다. API를 통한 값의 ‘검증/변환’ 등의 작업은 대상이 되는 API url에 대해서 HTTP url 방식의 호출이 일어나게 되며, 정해진 형태의 결과값을 반환해주어야 정상적으로 동작합니다.

- 이외의 경우에는, 오류로 처리되며 ‘value’가 채워지지 않은 것과 같은 의미로 해석이 되어 현재 수행중이던 파라미터에 대해서 슬롯필링 과정을 다시 수행되게 됩니다.

#### 그룹 파라미터

- 기본적으로 하나의 파라미터는 하나의 엔티티와 연결되며 각 블록안에서 유일한 이름을 갖습니다. 그룹 파라미터는 동작을 수행하는 데 필요한 정보가 그룹 내 하나만 해당해도 실행하는데 문제가 없을 때 주로 사용됩니다.
- 그룹을 생성하면 파라미터가 묶이게 됩니다.
- ‘그룹 파라미터’로 구성되어지는 순간, 해당 그룹은 ‘필수 파라미터’가 됩니다. 이 중에 하나 이상의 엔티티가 채워지면 슬롯필링이 완료됩니다.
- ‘검증 API’를 사용하는 파라미터가 그룹 파라미터인 경우에는 검증 결과가 성공하면 해당 그룹 파라미터는 슬롯필링이 완료되고, 실패하는 경우는 다음의 경우로 나뉩니다. 
  - 그룹 내 파라미터 중 슬롯필링이 된 경우가 없을 경우, 해당 그룹 파라미터는 슬롯필링을 수행합니다.
  - 나머지 파라미터 중 하나 이상이 슬롯필링이 되었다면 슬롯필링이 완료되고 다른 파라미터에 대한 체크가 진행됩니다. 아직 값이 채워지지 않은 다른 필수 파라미터나 그룹 파라미터가 더 존재한다면 그 파라미터들에 대해서 다시 슬롯필링이 진행됩니다.

#### 슬롯필링

- 필수 파라미터가 값이 채워지지않았을때 해당 ‘파라미터 값’을 채우기 위해서 ‘되묻기 질문’을 사용하여 사용자와 대화를 시도하는 과정입니다. 
- 이를 채워야 스킬에게 데이터를 넘겨주기때문에 반드시 필요한 과정
- 슬롯필링이 진행되는 동안에는 누적되어 있던 ‘컨텍스트(Context)’의 ‘라이프스팬(Lifespan)’은 차감되지 않고, 값을 채우기 위한 시도만 진행됩니다. 그리고, 슬롯필링을 시도하는 횟수는 ‘시나리오 설정’이나 ‘되묻기 질문’에서 설정할 수 있습니다.

### 파라미터에 연결된 스킬 실행 과정

